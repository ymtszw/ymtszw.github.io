# Agent実装ガイドライン

このドキュメントは、GitHub Copilot Agentや他の自動化ツールによる実装作業を進める際の共通指針を定めるものです。

## 前提事項

- **ブランチの事前作成**: エージェントによる実装を開始する前に、人間の開発者（リポジトリオーナー）が実装用のブランチを作成し、チェックアウトしておくこと
- **ブランチ命名**: ブランチ名は機能や目的を明確に示すこと（例: `feat/cloudflare_adapter`, `fix/bug-123`, `refactor/component-structure`）
- **Auto Approve設定**: エージェントが頻繁に実行するコマンド（`git commit`, `git add`, `npm run build`など）のAuto Approve設定は、人間の開発者が`.vscode/settings.json`の`chat.tools.terminal.autoApprove`に追加すること。エージェントはこの設定を変更してはならない

## エージェントが守るべき事前チェック

**重要**: 実装作業を開始する前に、以下を必ず確認すること：

1. **ブランチチェック**: 現在のブランチがデフォルトブランチ（`master`や`main`）でないことを確認する
2. **警告**: もしデフォルトブランチがチェックアウトされている場合は、実装を開始せず、人間の開発者に対して以下のメッセージを表示する：
   ```text
   ⚠️ 警告: 現在デフォルトブランチ（<branch-name>）がチェックアウトされています。
   実装作業を開始する前に、適切な機能ブランチを作成してチェックアウトしてください。

   例: git checkout -b feat/<feature-name>
   ```
3. **作業継続**: 適切なブランチがチェックアウトされている場合のみ、実装作業を進める

## 基本方針

### 実装アプローチ

- **既存実装を参考にする**: 関連する既存コードやライブラリの実装を理解し、プロジェクトの慣習に従う
- **型安全性を重視する**: TypeScript、Elmなどの型システムを最大限活用し、型定義を明確にする
- **段階的に実装する**: 詳細な実装計画を作成し、Phase分けして順次進める
- **困難に直面したら報告する**: 指示された内容や事前の計画に定めていた内容が実現しにくいことが判明した場合には、遠慮せずその旨を表明し、代替案の提示や指示を仰ぐこと。無理に実装を進めたり、問題を隠蔽してはならない

### ドキュメント管理

- **計画書の作成**: 実装開始前に、`docs/implementation-plans/`配下に詳細な実装計画を作成する
- **実装指針の記録**: 技術的な判断、設計決定、トラブルシューティングなどは適切なファイルに適宜書き残しながら進める
- **進捗管理**:
  - VSCode Copilotのtodoリスト機能を活用し、各タスクの状態を管理する
  - 実装計画書に「実装進捗」セクションを追加し、完了したPhaseやタスクを記録する（詳細は後述）
- **変更履歴**: 重要な実装や設計変更はGit commitとして記録する

## 開発の進め方

1. **計画を立てる**: 実装前に詳細な計画書を作成し、全体像と各タスクを明確にする
2. **計画書を配置**: `docs/implementation-plans/`に実装計画ドキュメントを配置する
3. **段階的に実装**: 各Phaseやタスクを完了させてから次に進む
4. **動作確認**: 各段階で適切にテストを実施する
5. **進捗を記録**: 実装計画書に進捗セクションを追加し、完了した内容を記録する（後述の「進捗管理」参照）
6. **技術的判断を記録**: 設計決定や課題は適宜ドキュメント化する
7. **コミット**: 意味のある単位でGit commitを作成する

## 進捗管理の方法

実装計画書には「実装進捗」セクションを追加し、セッション終了時や重要なマイルストーン達成時に更新すること。これにより、次回セッション開始時にエージェントが正確に状況を把握し、作業を継続できる。

### 進捗セクションの構造例

```markdown
## 10. 実装進捗

### Phase 1: 完了（YYYY-MM-DD）

**実装内容:**

- ✅ 完了したタスク1の説明
- ✅ 完了したタスク2の説明
- ✅ ビルド検証やテスト結果

**コミット:**

- `<commit-hash>`: コミットメッセージ
- `<commit-hash>`: コミットメッセージ

**成果物:**

- `path/to/file`: ファイルの説明
- 生成されたファイルや設定の概要

### Phase 2: 未着手

**残タスク:**

- 未完了タスク1
- 未完了タスク2
```

### 進捗記録のタイミング

- 各Phase完了時
- セッション終了時
- 重要な技術的決定や方針変更があった時
- 予期しない問題が発生し、解決方法を記録する必要がある時

### 進捗記録の目的

- セッション間での文脈の継続性を確保
- 実装の履歴と判断根拠を明確化
- 次回作業開始時の状況把握を容易にする
- プロジェクトの進捗を可視化

## ドキュメント構造

```text
docs/
├── GUIDELINES.md                    # このファイル（汎用的な指針）
└── implementation-plans/            # 個別の実装計画
    ├── <FEATURE_NAME>_PLAN.md      # 実装計画書（詳細仕様 + 進捗記録）
    └── ...
```

## プロジェクト固有の参考情報

- **プロジェクトREADME**: `../README.md`
- **主要技術スタック**: elm-pages v3, Vite, TypeScript, Elm
- **パッケージ管理**: npm/package.json

## 更新履歴

- 2025-12-11: 進捗管理の方法を追加（実装計画書への進捗記録セクション追加を義務化）
- 2025-12-11: Auto Approve設定に関する前提事項を追加
- 2025-12-11: 困難に直面した際の報告義務を明記
- 2025-12-10: 初版作成（汎用的な指針に限定）
